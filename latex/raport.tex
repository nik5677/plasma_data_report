%! Author = nikodem
%! Date = 24/01/2026

% Preamble
\documentclass[11pt]{article}

% Packages
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage[all]{hypcap}
\usepackage{polski}
\usepackage{xcolor}
\usepackage[a4paper, total={6in, 8in}]{geometry}
\usepackage{multirow}

\definecolor{darkorchid}{HTML}{9932CC}
% Hyperref configuration
\hypersetup{
    colorlinks=true,
    linkcolor=darkorchid,
    filecolor=magenta,
    urlcolor=blue
}

% Graphics directory
\graphicspath{ {./figures/} }

% Title and authors

\title{\textbf{Analiza danych rzeczywistych natężenia prądu plazmy przy pomocy modelu ARMA}}
\author{Dominika Lewandowska, Nikodem Drelak}

% Document
\begin{document}

    \maketitle
    \tableofcontents


    \section{Wstęp}\label{sec:wstep}

    \subsection{Cel pracy}\label{subsec:cel-pracy}

    Celem niniejszej pracy jest analiza statystyczna oraz modelowanie dynamiki szeregu czasowego pochodzącego z rzeczywistego eksperymentu fizycznego.
    Przedmiotem badań jest natężenie prądu plazmy (ang.\ \emph{Plasma Current}) zarejestrowane w urządzeniu typu tokamak.

    Głównym zadaniem jest weryfikacja hipotezy o możliwości opisu fluktuacji prądu w fazie stabilnej (tzw.\ \emph{flat-top}) za pomocą liniowego modelu stochastycznego klasy ARMA. Analiza obejmuje zbadanie stacjonarności procesu, identyfikację rzędu modelu, estymację parametrów oraz weryfikację założeń dotyczących reszt.

    \subsection{Opis i źródło danych}\label{subsec:opis-i-zrodo-danych}

    Dane wykorzystane w projekcie pochodzą z reaktora fuzyjnego MAST (Mega Ampere Spherical Tokamak), znajdującego się w Culham Centre for Fusion Energy w Wielkiej Brytanii.
    Zostały pobrane za pośrednictwem otwartego interfejsu API udostępnionego w ramach projektu \href{https://mastapp.site/index.html}{FAIR-MAST}.

    Interpretacja fizyczna zmiennej:
    Analizowana zmienna to natężenie prądu plazmy \( ( I_p ) \), wyrażone w kiloamperach \( (\text{kA}) \).
    W uproszczeniu, parametr ten jest kluczowym wskaźnikiem ,,życia'' eksperymentu:

    \begin{itemize}
        \item Wzrost prądu oznacza formowanie się plazmy.
        \item Utrzymywanie stałej wartości (plateau) oznacza fazę stabilną, w której przeprowadza się właściwe eksperymenty.
        \item Nagły spadek wartości do zera może sygnalizować niekontrolowaną utratę stabilności (tzw.\ disruption).
    \end{itemize}

    Dla potrzeb analizy szeregów czasowych, fluktuacje tego prądu w fazie stabilnej traktujemy jako proces stochastyczny, wynikający z turbulencji wewnątrz gorącego gazu oraz działania systemów sterowania reaktora.

    \subsection{Charakterystyka próby i wizualizacja}\label{subsec:charakterystyka-proby-i-wizualizacja}

    Do analizy wybrano eksperyment (tzw.\ \emph{shot}) o numerze ID: 30421.
    Pełny przebieg eksperymentu (przedstawiony na rysunku~\ref{fig:fig1}) trwa około 6 sekund.
    Ze względu na niestacjonarny charakter całego procesu (faza rozruchu i wygaszania), do modelowania ARMA wyodrębniono wycinek czasowy odpowiadający fazie stabilnej (rysunek~\ref{fig:fig2}).
    Zbiór analityczny odpowiada 0,37 sekundy obserwacji i zawiera 1850 próbek.
    W celu późniejszej weryfikacji poprawności modelowania ARMA dla przyszłych wartości, został on podzielony na zbiór treningowy - pierwsze 0,32 sekundy (1500 próbek) oraz zbiór testowy - ostatnie 0.05 sekund (250 próbek).

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{figure1}
        \caption{Pełny przebieg natężenia prądu plazmy w czasie eksperymentu. Półprzezroczystym obszarem zaznaczono obszar fazy stabilnej wybrany do analizy.}
        \label{fig:fig1}
    \end{figure}

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{figure2}
        \caption{Wyodrębniony fragment szeregu czasowego (faza \emph{flat-top}) poddany modelowaniu ARMA. Półprzezroczystym obszarem zaznaczono obszar zbioru testowego.}
        \label{fig:fig2}
    \end{figure}


    \section{Przygotowanie danych do analizy}\label{sec:przygotowanie}

    \subsection{Analiza jakości danych}\label{subsec:analiza_jakosci}
    Coś tam że dane nie mają braków itd.

    \subsubsection{Analiza autokorelacji surowych danych}

    wzory i opisanie ACF i PACF co to i wgl

    Rysunek~\ref{fig:empiryczna_acf_surowe} przedstawia to i to.
    Możemy wywnioskowac z tego, że cos tam.
    Interpretujemy to tak i tak

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{empiryczna_acf_surowe}
        \caption{Wykres współczynnika autokorelacji surowych danych ze zbioru treningowego w zależności od opóźnienia (parametru $h$). Półprzezroczystym obszarem zaznaczono przedział ufności o poziomie 95\%.}
        \label{fig:empiryczna_acf_surowe}
    \end{figure}

    Rysunek~\ref{fig:empiryczna_pacf_surowe} przedstawia to i to.
    Możemy wywnioskowac z tego, że cos tam.
    Interpretujemy to tak i tak

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{empiryczna_pacf_surowe}
        \caption{Wykres współczynnika częściowej autokorelacji surowych danych ze zbioru treningowego w zależności od opóźnienia (parametru $h$). Półprzezroczystym obszarem zaznaczono przedział ufności o poziomie 95\%.}
        \label{fig:empiryczna_pacf_surowe}
    \end{figure}

    test ADF weryfikujący hipotezę o niestacjonarności dla surowych danych (Augmented Dickey-Fuller Test) dał takie wyniki:
    Statystyka testowa = -0.665, p-value = 0.427 => Non-stationary.

    \subsection{Dekompozycja szeregu czasowego}\label{subsec:dekompozycja}

    \subsubsection{Różnicowanie danych}
    co to roznicowanie danych itd

    Rysunek~\ref{fig:dekompozycja} przedstawia to i to.
    Możemy wywnioskowac z tego, że cos tam.
    Interpretujemy to tak i tak

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{dekompozycja}
        \caption{Szereg czasowy ze zbioru treningowego poddany różnicowaniu. Przedstawia zmianę natężenia prądu w zależności od czasu.}
        \label{fig:dekompozycja}
    \end{figure}

    \subsubsection{Ocena autokorelacji danych po dekompozycji}

    Rysunek~\ref{fig:empiryczna_acf_po_dekompozycji} przedstawia to i to.
    Możemy wywnioskowac z tego, że cos tam.
    Interpretujemy to tak i tak

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{empiryczna_acf_po_dekompozycji}
        \caption{Wykres współczynnika autokorelacji danych ze zbioru treningowego poddanych różnicowaniu w zależności od opóźnienia (parametru $h$). Półprzezroczystym obszarem zaznaczono przedział ufności o poziomie 95\%.}
        \label{fig:empiryczna_acf_po_dekompozycji}
    \end{figure}

    Rysunek~\ref{fig:empiryczna_pacf_po_dekompozycji} przedstawia to i to.
    Możemy wywnioskowac z tego, że cos tam.
    Interpretujemy to tak i tak

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{empiryczna_pacf_po_dekompozycji}
        \caption{Wykres współczynnika częściowej autokorelacji danych ze zbioru treningowego poddanych różnicowaniu w zależności od opóźnienia (parametru $h$). Półprzezroczystym obszarem zaznaczono przedział ufności o poziomie 95\%.}
        \label{fig:empiryczna_pacf_po_dekompozycji}
    \end{figure}

    test ADF weryfikujący hipotezę o niestacjonarności dla danych po dekompozycji (Augmented Dickey-Fuller Test) dał takie wyniki:
    Statystyka testowa = -14.148, p-Value = 0.0 => Stationary.


    \section{Modelowanie przy pomocy ARMA}\label{sec:modelowanie_ARMA}

    \subsection{Dobranie rzędu modelu i parametrów}\label{subsec:dobranie_arma}

    co to rzad modelu, BIC, AIC, jak sie dobiera itd
    BIC (Bayesowskie Kryterium Informacyjne) i AIC (Kryterium Informacyjne Akaikego)
    dobralismy rzad modelu korzystajac z kryteriow informacyjnych w pakiecie pdarima???
    wyszlo: Best model: ARMA(7,6)???
    (my uzylismy 5,5 z rysunku~\ref{fig:dopasowanie_modelow})

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{dopasowanie_modelow}
        \caption{Heatmapa wartości kryteriów AIC oraz BIC w zależności od rzędów $p$ i $q$ modelu ARMA($p, q$) badanego szeregu. Jaśniejszy kolor oznacza niższą wartość kryterium.}
        \label{fig:dopasowanie_modelow}
    \end{figure}

    W tabeli~\ref{tab:tabela_parametry} przedstawiono paraametry wyznaczone metoda najwiekszej wiarygodnosci mle
    \input{tabela_parametry}

    \subsection{Ocena dopasowania modelu}\label{subsec:ocena_arma}

    \subsubsection{Porównanie empirycznych i teoretycznych ACV i PACV}

        Rysunek~\ref{fig:teoretycznaczna_acf} przedstawia to i to.
    Możemy wywnioskowac z tego, że cos tam.
    Interpretujemy to tak i tak

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{teoretycznaczna_acf}
        \caption{Wykres empirycznego i teoretycznego współczynnika autokorelacji modelu ARMA(5, 5) dopasowanego do zbioru treningowego, w zależności od opóźnienia (parametru $h$). Półprzezroczystym obszarem zaznaczono przedział ufności o poziomie 95\%.}
        \label{fig:teoretycznaczna_acf}
    \end{figure}

    Rysunek~\ref{fig:teoretycznaczna_pacf} przedstawia to i to.
    Możemy wywnioskowac z tego, że cos tam.
    Interpretujemy to tak i tak

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{teoretycznaczna_pacf}
        \caption{Wykres empirycznego i teoretycznego współczynnika częściowej autokorelacji modelu ARMA(5, 5) dopasowanego do zbioru treningowego, w zależności od opóźnienia (parametru $h$). Półprzezroczystym obszarem zaznaczono przedział ufności o poziomie 95\%.}
        \label{fig:teoretycznaczna_pacf}
    \end{figure}

    \subsubsection{Analiza trajektorii ARMA w porównaniu do badanego szeregu}

    Rysunek~\ref{fig:przedzialy_ufnosc_ARMA} przedstawia to i to.
    Możemy wywnioskowac z tego, że cos tam.
    Interpretujemy to tak i tak

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{przedzialy_ufnosc_ARMA}
        \caption{Trajektoria szeregu czasowego ze zbioru treningowego poddanego różnicowaniu oraz trajektoria dopasowanego modelu ARMA(5, 5) wraz z przedziałami ufności o poziomie 95\%.}
        \label{fig:przedzialy_ufnosc_ARMA}
    \end{figure}

    Rysunek~\ref{fig:przedzialy_ufnosc_ARMA_PRZEWIDYWANA} przedstawia to i to.
    Możemy wywnioskowac z tego, że cos tam.
    Interpretujemy to tak i tak

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{przedzialy_ufnosc_ARMA_PRZEWIDYWANA}
        \caption{Trajektoria szeregu czasowego ze zbioru treningowego i ze zbioru testowego poddanych różnicowaniu, oraz prognoza trajektorii dopasowanego modelu ARMA(5, 5) dla zbioru testowego wraz z przedziałami ufności o poziomie 95\%.}
        \label{fig:przedzialy_ufnosc_ARMA_PRZEWIDYWANA}
    \end{figure}

    \section{Weryfikacja założeń dotyczących szumu}\label{sec:weryfikacja-zaozen-dotyczacych-szumu}

    \subsection{Założenie dotyczące średniej}\label{subsec:zaozenie-dotyczace-sredniej}

    Rysunek~\ref{fig:test_srednie}
    co to za test i wgl:
   Test Średniej (T-test):
   Średnia reszt: -1.2344e-03
   P-value: 0.9389
    WNIOSEK: Brak podstaw do odrzucenia H0. Średnia jest równa 0.

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{test_srednie}
        \caption{Wykres wartości reszt modelu ARMA(5, 5) dopasowanego do zbioru treningowego. Czerwoną przerywaną linią zaznaczono średnią reszt o wartości około $-0.00123$.}
        \label{fig:test_srednie}
    \end{figure}


    \subsection{Założenie dotyczące wariancji}\label{subsec:zaozenie-dotyczace-wariancji}
    opisac co to za test itd
    Test Wariancji (ARCH Test):
   P-value: 0.0000
   WNIOSEK: Wykryto zmienną wariancję (efekt ARCH).

    sprawdzimy jak zmienia sie wariancja:
    opisać jak sie liczylo ta zmiane rezimu wariancji, co to $C_j$, $V_j$ \dots

    Rysunek~\ref{fig:test_wariancja}

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{test_wariancja}
        \caption{Wykresy przedstawiające kolejno: trajektorię reszt modelu ARMA(5, 5) dopasowanego do zbioru treningowego, sumę skumulowanych kwadratów reszt $\left(\rightC_j\right)$ oraz sumę błędów kwadratowych $V(j)$, w zależności od czasu. Czerwoną linią przerywaną zaznaczono punkt $l$, czyli punkt największej zmiany reżimu wariancji.}
        \label{fig:test_wariancja}
    \end{figure}


    \subsection{Założenie dotyczące niezależności}\label{subsec:zaozenie-dotyczace-niezaleznosci}

    co to za test i wgl:
    Test Niezależności (Ljung-Box, lag=10):
   P-value: 0.2137
   WNIOSEK: Reszty są niezależne (brak autokorelacji, biały szum).

    \subsubsection{Autokorelacja reszt}
    Reszty (błędy) w modelu ARMA/ARIMA reprezentują różnicę między obserwowanymi wartościami szeregu czasowego a wartościami przewidywanymi (dopasowanymi) przez model.
    Poprawne reszty powinny zachowywać się jak „biały szum”, czyli mieć stałą wariancję, zerową średnią i brak autokorelacji.

    Rysunek~\ref{fig:empiryczna_acf_po_dekompozycji_RESZTY} przedstawia to i to.
    Możemy wywnioskowac z tego, że cos tam.
    Interpretujemy to tak i tak

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{empiryczna_acf_po_dekompozycji_RESZTY}
        \caption{Wykres współczynnika autokorelacji reszt modelu ARMA(5, 5) w zależności od opóźnienia (parametru $h$). Półprzezroczystym obszarem zaznaczono przedział ufności o poziomie 95\%.}
        \label{fig:empiryczna_acf_po_dekompozycji_RESZTY}
    \end{figure}

    Rysunek~\ref{fig:empiryczna_pacf_po_dekompozycji_RESZTY} przedstawia to i to.
    Możemy wywnioskowac z tego, że cos tam.
    Interpretujemy to tak i tak

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{empiryczna_pacf_po_dekompozycji_RESZTY}
        \caption{Wykres współczynnika częściowej autokorelacji reszt modelu ARMA(5, 5) w zależności od opóźnienia (parametru $h$). Półprzezroczystym obszarem zaznaczono przedział ufności o poziomie 95\%.}
        \label{fig:empiryczna_pacf_po_dekompozycji_RESZTY}
    \end{figure}

    \subsection{Założenie dotyczące normalności rozkładu}\label{subsec:zaozenie-dotyczace-normalnosci-rozkadu}

    Rysunek~\ref{fig:test_normalnosc}

    co to za test i wgl:
    Test Normalności (Jarque-Bera):
   P-value: 0.0000
   WNIOSEK: Rozkład nie jest idealnie normalny (częste w danych fizycznych).

    \begin{figure}[hp]
        \centering
        \includegraphics[width=1\textwidth]{test_normalnosc}
        \caption{Histogram i empiryczna gęstość oraz wykres kwantylowy (QQ-plot) wartości reszt w porównaniu do rozkładu normalnego (czerwona, przerywana linia) o parametrach wyznaczonych na podstawie badanej próby reszt (średniej i wariancji z próby).}
        \label{fig:test_normalnosc}
    \end{figure}

    \section{Wnioski}\label{sec:wnioski}
    nie zgadza sie wariancja ani normalnosc wiec nie mozna uzyc arma do modelowania tego typu danych

    \section{Podsumowanie}\label{sec:podsumowanie}
    nie mozna uzywac arma ale i tak daje wyniki zawierajace sie w przedziale ufnosci.
    i do tego typu danych lepiej uzywac innych modeli ktore uwzgledniaja zmiany wariancji i brak normalnosci np ARCH, GARCH\dots


\clearpage
\phantomsection
\addcontentsline{toc}{section}{Literatura}
\nocite{*}
\bibliographystyle{plain}
\bibliography{bibliografia}

\end{document}